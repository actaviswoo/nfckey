# NFC Shop - Магазин кастомных NFC-брелков

## Описание проекта

Интернет-магазин для заказа кастомных NFC-брелков с возможностью нанесения индивидуальной гравировки. Проект разработан на Django 4.2.

**Домен:** nftkey.russianode.ru  
**IP сервера:** 138.124.74.169

---

## Этапы разработки и развертывания

### 1. Разработка на localhost

#### 1.1. Создание проекта Django
```bash
django-admin startproject nfcshop
cd nfcshop
python manage.py startapp shop
```

#### 1.2. Настройка проекта
- Создан файл `requirements.txt` с зависимостями:
  - Django>=4.2.0,<5.0.0
  - python-decouple>=3.8
  - gunicorn>=21.2.0
  - Pillow>=10.0.0

#### 1.3. Разработка моделей
Созданы модели в `shop/models.py`:
- **Product** - модель продукта (NFC-брелок) с полями:
  - название, описание, цена
  - изображение
  - даты создания и обновления
- **Order** - модель заказа с полями:
  - связь с продуктом
  - данные клиента (имя, email, телефон)
  - текст для гравировки
  - количество
  - статус заказа (новый, в обработке, выполнен)

#### 1.4. Создание миграций и применение
```bash
python manage.py makemigrations
python manage.py migrate
```

#### 1.5. Разработка представлений (views)
Созданы views для:
- Главной страницы со списком продуктов
- Страницы детального просмотра продукта
- Формы оформления заказа
- Страницы успешного оформления заказа
- Списка заказов (для администратора)

#### 1.6. Создание шаблонов
Разработаны HTML-шаблоны в `shop/templates/shop/`:
- `base.html` - базовый шаблон
- `index.html` - главная страница
- `product_detail.html` - страница продукта
- `order_success.html` - подтверждение заказа
- `orders_list.html` - список заказов

#### 1.7. Настройка URL-маршрутов
Настроены маршруты в `shop/urls.py` и `nfcshop/urls.py`

#### 1.8. Настройка админ-панели
Зарегистрированы модели в `shop/admin.py` для управления через Django Admin

#### 1.9. Тестирование на localhost
```bash
python manage.py runserver
```
Проект протестирован на `http://localhost:8000`

---

### 2. Подготовка к деплою

#### 2.1. Настройка settings.py для production
- Настроено использование `python-decouple` для переменных окружения
- Добавлены настройки безопасности для production:
  - SECURE_SSL_REDIRECT
  - SESSION_COOKIE_SECURE
  - CSRF_COOKIE_SECURE
  - SECURE_HSTS
- Настроены ALLOWED_HOSTS для домена и IP

#### 2.2. Создание скрипта деплоя
Создан автоматизированный скрипт `deploy.sh` для развертывания на сервере

---

### 3. Развертывание на production сервере

#### 3.1. Подключение к серверу
Подключение к серверу по IP: 138.124.74.169

#### 3.2. Загрузка проекта на сервер
Проект загружен в директорию на сервере

#### 3.3. Запуск скрипта деплоя
```bash
sudo ./deploy.sh
```

#### 3.4. Что делает скрипт деплоя:

**Шаг 1: Обновление системы**
- Обновление пакетов через `apt-get update`
- Установка необходимых пакетов: Python3, pip, venv, nginx, certbot

**Шаг 2: Создание виртуального окружения**
- Создание изолированного Python окружения

**Шаг 3: Установка зависимостей**
- Установка всех пакетов из `requirements.txt`

**Шаг 4: Настройка переменных окружения**
- Автоматическая генерация SECRET_KEY
- Создание файла `.env` с настройками:
  - SECRET_KEY
  - DEBUG=False
  - ALLOWED_HOSTS
  - SECURE_SSL_REDIRECT=True

**Шаг 5: Применение миграций БД**
- Выполнение `python manage.py migrate`

**Шаг 6: Сбор статических файлов**
- Выполнение `python manage.py collectstatic`

**Шаг 7: Создание директорий для логов**
- Создание `/var/log/nfcshop/` для хранения логов

**Шаг 8: Настройка прав доступа**
- Установка владельца `www-data` для проекта
- Настройка прав доступа к файлам

**Шаг 9: Создание systemd сервиса**
- Создание сервиса `nfcshop.service` для запуска Gunicorn
- Настройка автозапуска при загрузке системы
- Gunicorn запускается на порту 8000

**Шаг 10: Настройка Nginx**
- Создание конфигурации Nginx для домена `nftkey.russianode.ru`
- Настройка проксирования на Gunicorn (порт 8000)
- Настройка раздачи статических файлов
- Настройка раздачи медиа-файлов

**Шаг 11: Запуск сервисов**
- Перезагрузка systemd
- Включение и запуск сервиса nfcshop
- Перезапуск Nginx

**Шаг 12: Получение SSL сертификата**
- Автоматическое получение SSL сертификата от Let's Encrypt через certbot
- Настройка HTTPS редиректа

**Шаг 13: Проверка статуса**
- Проверка работоспособности всех сервисов

---

### 4. Результат

✅ Проект успешно развернут и доступен по адресу: **https://nftkey.russianode.ru**

#### Функциональность:
- Просмотр каталога NFC-брелков
- Детальный просмотр каждого продукта
- Оформление заказа с указанием текста для гравировки
- Административная панель для управления продуктами и заказами
- Безопасное HTTPS соединение

#### Полезные команды для управления:
```bash
# Статус сервиса
systemctl status nfcshop

# Просмотр логов
journalctl -u nfcshop -f

# Перезапуск сервиса
systemctl restart nfcshop

# Создание суперпользователя
cd /path/to/project
source venv/bin/activate
python manage.py createsuperuser
```

---

## Технологический стек

- **Backend:** Django 4.2
- **WSGI сервер:** Gunicorn
- **Веб-сервер:** Nginx
- **База данных:** SQLite3
- **SSL:** Let's Encrypt (Certbot)
- **Процесс-менеджер:** systemd

---

## Структура проекта

```
nfckey/
├── manage.py
├── requirements.txt
├── deploy.sh
├── .env (создается при деплое)
├── venv/ (создается при деплое)
├── nfcshop/
│   ├── settings.py
│   ├── urls.py
│   ├── wsgi.py
│   └── asgi.py
└── shop/
    ├── models.py
    ├── views.py
    ├── urls.py
    ├── admin.py
    ├── forms.py
    └── templates/
        └── shop/
            ├── base.html
            ├── index.html
            ├── product_detail.html
            ├── order_success.html
            └── orders_list.html
```

